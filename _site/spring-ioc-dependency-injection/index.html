<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="jackhance's blog" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="jackhance's blog" /> <title> Spring 卷 - IOC 篇 - Spring Ioc 依赖注入 - jackhance's blog </title> <link rel="alternate" href="http://localhost:4000/spring-ioc-dependency-injection/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/spring-ioc-dependency-injection/" /> <meta name="description" content="Spring Ioc 依赖注入详解" /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Spring 卷 - IOC 篇 - Spring Ioc 依赖注入 | jackhance" /> <meta property="og:title" content="Spring 卷 - IOC 篇 - Spring Ioc 依赖注入 | jackhance" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/spring-ioc-dependency-injection/" /> <meta property="og:description" content="Spring Ioc 依赖注入详解" /> <meta property="og:image" content="http://localhost:4000/assets/img/ogp.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Spring 卷 - IOC 篇 - Spring Ioc 依赖注入 | jackhance" /> <meta name="twitter:url" content="http://localhost:4000/spring-ioc-dependency-injection/" /> <meta name="twitter:site" content="@jackhance" /> <meta name="twitter:creator" content="@jackhance" /> <meta name="twitter:description" content="Spring Ioc 依赖注入详解" /> <meta name="twitter:image" content="http://localhost:4000/assets/img/ogp.png" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="jackhance's blog" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#java">JAVA</a>, <a class="tag" href="/tags/#spring">SPRING</a>, <a class="tag" href="/tags/#ioc">IOC</a>, <a class="tag" href="/tags/#dependency">DEPENDENCY</a>, <a class="tag" href="/tags/#injection">INJECTION</a> </span> </div> <h1 class="header-title" itemprop="headline">Spring 卷 - IOC 篇 - Spring Ioc 依赖注入</h1> <div class="post-meta"> <time datetime="2021-10-14T22:11:00+08:00" itemprop="datePublished"> Oct 14, 2021 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">jackhance</span> </span> <time hidden datetime="2021-10-14T22:11:00+08:00" itemprop="dateModified"> Oct 14, 2021 </time> <span hidden itemprop="publisher" itemtype="Person">jackhance</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><h3 id="依赖注入的模式和类型">依赖注入的模式和类型</h3> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <h3 id="依赖注入的模式和类型"> <a href="#依赖注入的模式和类型" class="anchor-head"></a> 依赖注入的模式和类型 </h3> <h4 id="模式"> <a href="#模式" class="anchor-head"></a> 模式 </h4> <ul> <li>手动模式：通过配置或者API的方式，确定注入规则。 <ul> <li>xml 资源配置元信息，实现依赖注入</li> <li>Java 注解配置元信息，实现依赖注入</li> <li>API 配置元信息，实现依赖注入</li> </ul> </li> <li>自定模式：实现方提供依赖自动关联的方式，BeanFactory 容器按照内建的注入规则，实现依赖注入。 <ul> <li>Autowiring 自动绑定</li> </ul> </li> </ul> <h4 id="类型"> <a href="#类型" class="anchor-head"></a> 类型 </h4> <ol> <li>Setter 方法：<code class="language-plaintext highlighter-rouge">&lt;property name="worker" ref="workerBean"/&gt;</code></li> <li>构造器: <code class="language-plaintext highlighter-rouge">&lt;constructor-arg name="id" value="123" /&gt;</code></li> <li>字段: <code class="language-plaintext highlighter-rouge">@Resource Worker worker;</code></li> <li>方法: <code class="language-plaintext highlighter-rouge">@Autowire public void doWorker(Worker worker) {...}</code></li> <li>接口回调 Aware: <code class="language-plaintext highlighter-rouge">class Demo implements ApplicationContextAware {...}</code></li> </ol> <p><br /></p> <hr /> <h3 id="自动绑定autowiring"> <a href="#自动绑定autowiring" class="anchor-head"></a> 自动绑定（Autowiring） </h3> <p>什么是自动绑定呢？我从官网摘录了部分：<sup id="autowiring-collaborators"><a href="#autowiring-collaborators-ref">[1]</a></sup></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The Spring container can autowire relationships between collaborating beans. You can let Spring resolve collaborators (other beans) automatically for your bean by inspecting the contents of the ApplicationContext. Autowiring has the following advantages:

Autowiring can significantly reduce the need to specify properties or constructor arguments. (Other mechanisms such as a bean template discussed elsewhere in this chapter are also valuable in this regard.)

Autowiring can update a configuration as your objects evolve. For example, if you need to add a dependency to a class, that dependency can be satisfied automatically without you needing to modify the configuration. Thus autowiring can be especially useful during development, without negating the option of switching to explicit wiring when the code base becomes more stable.
</code></pre></div></div> <p>Spring 容器可通过自动绑定 Bean 协作者之间的关系。当然这里的 Bean 并不只是我们注册到 Spring 容器内部的，还包含了内建的 Bean ，外部的配置资源等等。因此我觉得这里用协作者是比较恰当的。</p> <p>Spring 的自动绑定包含了俩个优点：</p> <ol> <li>自动绑定显著地减少了指定属性或者构造器参数的需求。</li> <li>自动绑定会自适应配置。如<code class="language-plaintext highlighter-rouge">&lt;property name="name" ref="jackhance"/&gt;</code> ,名称为 jackhance 的 Bean 的配置变化时，这里绑定的属性会同时变化，而不像<code class="language-plaintext highlighter-rouge">&lt;property name="name" value="jackhance"/&gt;</code> 固化为 jackhance，一成不变。</li> </ol> <h4 id="自动绑定模式"> <a href="#自动绑定模式" class="anchor-head"></a> 自动绑定模式 </h4> <ul> <li>no ： 默认值，Autowiring 未激活，需要手动绑定</li> <li>byName ：依据属性的名称作为 Bean 名称进行依赖查找，并将查找到的 Bean 进行绑定</li> <li>byType ： 依据属性的类型进行依赖查找，并将查找到的 Bean 进行绑定</li> <li>constructor ：特殊 byType 类型，用于构造器参数注入</li> </ul> <p>在 Spring 中有对应的枚举，<code class="language-plaintext highlighter-rouge">org.springframework.beans.factory.annotation.Autowire</code>:</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Autowire</span> <span class="o">{</span>

	<span class="cm">/**
	 * Constant that indicates no autowiring at all.
	 */</span>
	<span class="no">NO</span><span class="o">(</span><span class="nc">AutowireCapableBeanFactory</span><span class="o">.</span><span class="na">AUTOWIRE_NO</span><span class="o">),</span>

	<span class="cm">/**
	 * Constant that indicates autowiring bean properties by name.
	 */</span>
	<span class="no">BY_NAME</span><span class="o">(</span><span class="nc">AutowireCapableBeanFactory</span><span class="o">.</span><span class="na">AUTOWIRE_BY_NAME</span><span class="o">),</span>

	<span class="cm">/**
	 * Constant that indicates autowiring bean properties by type.
	 */</span>
	<span class="no">BY_TYPE</span><span class="o">(</span><span class="nc">AutowireCapableBeanFactory</span><span class="o">.</span><span class="na">AUTOWIRE_BY_TYPE</span><span class="o">);</span>

    <span class="c1">//...</span>
<span class="o">}</span>

</code></pre></div></div> <h4 id="自动绑定的限制"> <a href="#自动绑定的限制" class="anchor-head"></a> 自动绑定的限制 </h4> <p>我从官网摘录了部分：<sup id="limitations-and-disadvantages-of-autowiring"><a href="#limitations-and-disadvantages-of-autowiring-ref">[2]</a></sup></p> <ul> <li>显式指定依赖会覆盖自动绑定。</li> <li>无法自动绑定原始类型（e.g. int、short、long）、Strings、Classes 。Spring故意这么设计的。（自动绑定本身伴随着不确定性，绑定的范围进行限定，应该是降低不确定性造成的影响）</li> <li>相比明确的绑定，自动绑定是缺乏精确性的。使用自动绑定时，Spring 需要猜测绑定的 Bean ，如果出现歧义，会产生不想期待的结果。</li> <li>若通过 setter 方法或者构造器注入时，匹配结果为多个 Bean ，但是方法期待的结果为单个 Bean ，这时会抛错。需要指定 @Primary 的 Bean。</li> </ul> <p><br /></p> <hr /> <h3 id="setter-方法依赖注入"> <a href="#setter-方法依赖注入" class="anchor-head"></a> Setter 方法依赖注入 </h3> <p><br /></p> <hr /> <h3 id="构造器依赖注入"> <a href="#构造器依赖注入" class="anchor-head"></a> 构造器依赖注入 </h3> <p><br /></p> <hr /> <h3 id="字段依赖注入"> <a href="#字段依赖注入" class="anchor-head"></a> 字段依赖注入 </h3> <p><br /></p> <hr /> <h3 id="方法依赖注入"> <a href="#方法依赖注入" class="anchor-head"></a> 方法依赖注入 </h3> <p><br /></p> <hr /> <h3 id="回调依赖注入"> <a href="#回调依赖注入" class="anchor-head"></a> 回调依赖注入 </h3> <p><br /></p> <hr /> <h3 id="依赖注入类型选择"> <a href="#依赖注入类型选择" class="anchor-head"></a> 依赖注入类型选择 </h3> <p><br /></p> <hr /> <h3 id="基础类型注入"> <a href="#基础类型注入" class="anchor-head"></a> 基础类型注入 </h3> <p><br /></p> <hr /> <h3 id="集合类型注入"> <a href="#集合类型注入" class="anchor-head"></a> 集合类型注入 </h3> <p><br /></p> <hr /> <h3 id="限定注入"> <a href="#限定注入" class="anchor-head"></a> 限定注入 </h3> <p><br /></p> <hr /> <h3 id="延迟依赖注入"> <a href="#延迟依赖注入" class="anchor-head"></a> 延迟依赖注入 </h3> <p><br /></p> <hr /> <h3 id="autowired-注入原理"> <a href="#autowired-注入原理" class="anchor-head"></a> @Autowired 注入原理 </h3> <p><br /></p> <hr /> <h3 id="java-通用注解注入原理"> <a href="#java-通用注解注入原理" class="anchor-head"></a> Java 通用注解注入原理 </h3> <p>CommonAnnotationBeanPostProcessor</p> <p><br /></p> <hr /> <h3 id="inject-注入原理"> <a href="#inject-注入原理" class="anchor-head"></a> @Inject 注入原理 </h3> <p><br /></p> <hr /> <h3 id="自定义依赖注入"> <a href="#自定义依赖注入" class="anchor-head"></a> 自定义依赖注入 </h3> <p><br /></p> <hr /> <h3 id="小记"> <a href="#小记" class="anchor-head"></a> 小记 </h3> <p><small id="autowiring-collaborators-ref"><sup><a href="#autowiring-collaborators">[1]</a></sup> <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-autowire" target="_blank"> Autowiring Collaborators </a></small></p> <p><small id="limitations-and-disadvantages-of-autowiring-ref"><sup><a href="#limitations-and-disadvantages-of-autowiring">[1]</a></sup> <a href="https://docs.spring.io/spring-framework/docs/5.2.16.RELEASE/spring-framework-reference/core.html#beans-autowired-exceptions" target="_blank"> limitations and disadvantages of autowiring </a></small></p> <p><br /></p> <hr /> <h3 id="代码"> <a href="#代码" class="anchor-head"></a> 代码 </h3> <p><a href="https://github.com/jackhance0825/thinking-in-spring-5.2.16/tree/main/ioc-dependency-injection" target="_blank"> 本篇章代码 </a></p> </div> </article> </main> <small class="post-updated-at">updated_at 14-10-2021</small> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/spring-ioc-dependency-lookup/" > <div class="nav-arrow">Previous</div> <span class="post-title">Spring 卷 - IOC 篇 - Spring Ioc 依赖查找</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="/thanks">ack.</a> <a class="footer_item" href="javascript::void(0)">resume</a> <a class="footer_item" href="/feed.xml">rss</a> <span class="footer_item">&copy; 2021</span> <small class="footer_copyright"> <!-- Klisé Theme: https://github.com/piharpi/jekyll-klise --> <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisé</a > theme on <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener" >jekyll</a > </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
